---
title: "Midterm Project"
author: "Jianjun Gao, Aaron Yang, Luhuan Wang"
# date: "today"
date: "`r Sys.Date()`" 
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

# Factors Influencing Ride-Sharing Pricing in Boston: A Study on Lyft and Uber

```{r init, include=F,error=TRUE}
# Loading the libraries.
library(ggplot2)
library(ezids)
library(gplots)
library(dplyr)
library(plotly)
```

```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```
## Loading the Data from Csv File
**Look at first 6 rows of the data.**
```{r, results='markup', echo=TRUE}
df <- data.frame(read.csv('final_dataset.csv'))
head(df)
```
## Data EDA
**Get summary from the data**

We want to have an initial look at the descriptive stats of the dataset. In the same time, check for the null values of the data.
```{r, results='markup', echo=TRUE}
summary(df) # descriptive stats
sum(is.na(df)) # check null values
```
**Alter column names**

We found that some of the cols are named incorrectlly, we need to alter them.
```{r, results='markup', echo=TRUE}
#alter col names
colnames(df)[colnames(df) == "cab_type"] <- "cab_company"
colnames(df)[colnames(df) == "name"] <- "cab_type"
head(df)
```

**Check for unique values in catgorial columns**

For cab_company, we can see there are 2 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_company) #see unique values in company
```

For cab_type, we can see there are 12 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_type) #see unique values in cab_type
```

## Data Visualization
**Hour vs Mean_Price**

We want to see the relationship of hours contributed to mean_price.
```{r, results='markup', echo=TRUE}

# Extract relevant columns from 'data' into 'cab_data'
cab_data <- df[c("hour", "price", "cab_company")]

# Filter the data for each company
uber_data <- cab_data[cab_data$cab_company == 'Uber',]
lyft_data <- cab_data[cab_data$cab_company == 'Lyft',]

# Plot for Uber
ggplot(data = uber_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "blue") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Uber Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Plot for Lyft
ggplot(data = lyft_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "red") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Lyft Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Combined plot 
ggplot(data = cab_data, aes(x = hour, y = price, color = cab_company, group = cab_company)) + 
  geom_line() + 
  geom_point(aes(shape = cab_company)) +
  labs(title = "Hourly Uber vs Lyft Prices", x = "Hour", y = "Price") +
  scale_color_manual(values = c("blue", "red")) +
  theme_minimal()

```

**Company vs price**

We want to see if there is a difference in price in case of uber and lyft.
```{r, results='markup', echo=TRUE}
# Create a figure with two subplots
par(mfrow=c(1, 2), mar=c(5, 4, 4, 2))  # 1 row, 2 columns

# Plot histograms by cab_type for Lyft
hist(df$price[df$cab_company == "Lyft"], col="orange", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Lyft)")

# Plot histograms by cab_type for Uber
hist(df$price[df$cab_company == "Uber"], col="blue", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Uber)")

# Add legend to the figure
legend("topright", legend=c("Uber", "Lyft"), fill=c("blue", "orange"))
```

**Cab types vs Price**

We want to see if cab types affect prices.
```{r, results='markup', echo=TRUE}
df_lyft <- df[df$cab_company == "Lyft",]
df_uber <- df[df$cab_company == "Uber",]

# Combine the data for Lyft and Uber
df_combined <- rbind(df_lyft, df_uber)

# Calculate the median price for each cab type and order them
median_prices <- df_combined %>%
  group_by(cab_type) %>%
  summarize(median_price = median(price)) %>%
  arrange(desc(median_price))

# Reorder the levels of the cab_type factor based on median price
df_combined$cab_type <- factor(df_combined$cab_type, levels = median_prices$cab_type)

# Create a ggplot object for both Lyft and Uber with cab_type reordered
p_combined <- ggplot(df_combined, aes(x = cab_type, y = price, fill = cab_company)) +
  geom_boxplot(width = 0.5, outlier.shape = 1, outlier.size = 2, fatten = 0.5) +  # Adjust outlier size and line thickness
  labs(x = "Cab Type", y = "Price", title = "Boxplot of Prices by Cab Type (Ordered by Median Price)") +
  scale_fill_manual(values = c("Lyft" = "blue", "Uber" = "red")) +  # Set custom colors
  theme_minimal() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5),
    plot.margin = unit(c(1, 2, 1, 1), "cm")
  )

# Print the combined plot with modified aesthetics
p_combined


```

**Distance vs Price**

Use scatter plot to see the relationship between the distance and price.
```{r, results='markup', echo=TRUE}
# Scatter plot: Examine the relationship between price and distance
ggplot(df, aes(x = distance, y = price)) +
  geom_point(aes(color = price), alpha = 0.5) +    # Use color to represent the value of price and set point transparency to 0.5
  labs(title = "The Plot of Price vs. Distance",    # Chart title
       x = "Distance",                              # x-axis title
       y = "Price",                                 # y-axis title
       color = "Price Value") +                     # Legend title
  theme_minimal()                                   # Use a minimalistic theme
```

**Surge_multiplier vs Price**

Use boxplot to see the relationship between the surge_multiplier and price.
```{r, results='markup', echo=TRUE}
# Box plot: Examine the distribution of price across different surge multipliers
ggplot(df, aes(x = factor(surge_multiplier), y = price)) +  # Convert surge_multiplier to factor for a clearer plot
  geom_boxplot(aes(fill = factor(surge_multiplier))) +        # Fill boxes with colors based on surge_multiplier
  labs(title = "Boxplot of Price across Different Surge Multipliers",
       x = "Surge Multiplier",
       y = "Price",
       fill = "Surge Multiplier Categories") +
  theme_minimal()
```

**Plot a 3D scatter plot with arguements hour, distance, price**

``````{r, results='markup', echo=TRUE}
# Create a 3D scatter plot
plot_ly(data = df, x = ~hour, y = ~distance, z = ~price, type = "scatter3d", mode = "markers", marker = list(size = 1)) %>%
  layout(scene = list(xaxis = list(title = "Hour"), yaxis = list(title = "Distance"), zaxis = list(title = "Price")))

```

## Description Statistics

**Show standard deviations**

```{r, results='markup', echo=TRUE}
# measure of variance
sd(df$price)
sd(df$distance)
sd(df$surge_multiplier)
```

**Test normality**

For hour
```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$hour)

# Create a Q-Q plot
qqnorm(df$hour)
qqline(df$hour)

# Create a density plot
plot(density(df$hour))
```

For price

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$price)

# Create a Q-Q plot
qqnorm(df$price)
qqline(df$price)
plot(density(df$price))
```

For distance

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$distance)

# Create a Q-Q plot
qqnorm(df$distance)
qqline(df$distance)
plot(density(df$distance))
```

For surge_multiplier

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$surge_multiplier)

# Create a Q-Q plot
qqnorm(df$surge_multiplier)
qqline(df$surge_multiplier)
plot(density(df$surge_multiplier))
```

## Correlation Heatmap for Numeric Colmns

```{r, results='markup', echo=TRUE}
#plot a correlation heat map
df_numeric <- df[,1:4] #only numeric cols
cor_matrix <- cor(df_numeric) #cor matrix

heatmap.2(cor_matrix, 
          main = "Correlation Heatmap",  # title
          key = TRUE,  # show color
          density.info = "none",  # prevent duplicate color
          trace = "none",  # prevent trace
          cellnote = round(cor_matrix, 2),  # show cor
          notecol = "black",  # color for cor
          margins = c(5, 5),  # set margins
          col = colorRampPalette(c("blue", "white", "red"))(100)  # set color
)
```

## Chi-Squared Test for Cab_company & Cab_type

```{r, results='markup', echo=TRUE}
# Chi-squared test
chisq_result <- chisq.test(df$cab_company, df$cab_type)

chisq_result
```

## Linear Regression Analysis for distance & surge_multiplier & hour

```{r, results='markup', echo=TRUE}
#linear regression analysis
linear_model <- lm(price~distance + surge_multiplier,data = df)
summary(linear_model)
```





