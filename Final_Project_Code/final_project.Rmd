---
title: "Factors Influencing Ride-Sharing Pricing in Boston: A Study on Lyft and Uber"
author:
- name: Jianjun Gao
- name: Aaron Yang
- name: Luhuan Wang
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
      smooth_scroll: yes
    number_sections: no
    fig_caption: yes
    df_print: paged
    css: "apa-style.css"
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
affiliation: George Washington University
advisor: Dr. Mohamed Shabani Kariburyo
subtitle: DATS_6101_Midterm_Project_Summary_Paper
shorttitle: "Ride-Sharing Pricing in Boston"
---


# 1. Introduction

Exploring the factors influencing ride-sharing pricing, particularly in the context of Boston's Uber and Lyft services, is crucial. This investigation offers insights into the dynamic pricing strategies of these prominent ride-sharing companies. Understanding these factors is not only beneficial for consumers seeking cost-effective transportation options but also for the companies themselves in optimizing their pricing models in a highly competitive market.

A pertinent study conducted on the ride-share market in Boston focused on analyzing Uber vs. Lyft. This research delved into the pricing strategies of these companies, examining a multitude of factors such as weather conditions, traffic, and special events, and how they impact pricing. The findings revealed notable differences in the pricing models of Uber and Lyft, influenced by various external and internal factors, providing an enlightening perspective on ride-sharing economics in urban areas (NYC Data Science Academy, n.d.)[2].

In our mid-term project, we analyzed a dataset comprising factors like "hour", "price", "surge_multiplier", "cab_type", and "name", with 6,000 entries in each category. Our analysis revealed significant correlations, particularly between ride distance, peak-hour passenger surge multipliers, and pricing. We found that longer distances and higher passenger numbers during peak hours tend to increase prices. Conversely, the time of day showed a weaker correlation with pricing. Additionally, a notable relationship was observed between cab companies and types, suggesting that different service models and vehicle types significantly influence pricing strategies. This study provided a foundational understanding of the elements affecting ride-sharing prices in Boston.

For the final project, we have expanded our scope by utilizing a more extensive dataset containing 637,976 rows and 57 columns, sourced from https://www.kaggle.com/datasets/brllrb/uber-and-lyft-dataset-boston-ma/data[1]. This larger dataset allows for a more comprehensive analysis, incorporating a wider range of variables. We have also explored various advanced modeling techniques to deepen our understanding of the complex dynamics governing ride-sharing pricing in Boston.

The next sections of our paper will bridge the gap between our mid-term and final projects, highlighting the advancements and new insights gained. Following this, we will conduct an extensive Exploratory Data Analysis (EDA) of the expanded dataset, which will be succeeded by sophisticated modeling techniques to unravel the intricacies of ride-sharing pricing. The final section will synthesize our findings, offering conclusive insights and potential directions for future research in this domain.

# 2. The Gap between Mid-term and Final project

## 2.1 Mid-Term Project Description

In the mid-term project, our exploration hinged on three pivotal statistical concepts: standard deviation, normality tests, and chi-squared tests. By scrutinizing the standard deviation, we probed the variability and consistency within the pricing data of the shared transportation domain. This metric was pivotal in discerning the price volatility under various conditions, offering a window into the data's stability and reliability. The normality tests were instrumental in determining the data distribution's alignment with a normal curve, a step that is vital for the selection of appropriate statistical techniques and for the accurate interpretation of outcomes. The chi-squared test was adeptly employed to delve into the association between two categorical variables — Cab_company and Cab_type. The findings from this test were particularly telling, with a chi-squared value of 6000, degrees of freedom standing at 11, and an exceptionally low p-value, all of which collectively underscored a strong correlation between the type of cab service provided and the company offering it. The outcomes pointed to a significant interplay between these variables, suggesting a systematic relationship rather than independent variability.

## 2.2 Gap Analysis Between Mid-Term and Final Project

Transitioning to the final project, we expanded our analytical horizon by incorporating models such as Linear Regression, Principal Component Regression (PCR), and Tree Models. The introduction of Linear Regression aimed to quantitatively dissect the relationship between price and its influencing factors like time and distance. PCR was anticipated to address multicollinearity by marrying principal component analysis with linear regression, thus enhancing the model's interpretability. Meanwhile, the Tree Model was set to offer a non-linear viewpoint, capable of unraveling intricate patterns within the data that linear models may overlook. The rich dataset, now expanded to 693,071 records across 57 variables, provided a comprehensive canvas, capturing nuanced details of ride-hailing services, including time, location, price, distance, and even meteorological variables. This breadth of data allowed for a multifaceted analysis, going beyond the mid-term project's scope by applying these sophisticated statistical methods to extract deeper insights into the dynamics of ride-hailing prices. Such insights are poised to refine our understanding of pricing strategies in shared mobility services, enriching the knowledge base for consumers and service providers alike.

# 3. Exploratory Data Analysis

```{r, include=F,error=TRUE}
# Loading the libraries.
library(papaja)
library(ggplot2)
library(ezids)
library(gplots)
library(dplyr)
library(plotly)
library(corrplot)
library(lubridate)
library(caTools)
library(tm)
library(irlba)
library(text2vec)
library(recipes)
library(yardstick)
library(pls)
library(tree)
library(rmarkdown)
```

```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```

## 3.1 Dataset Overview 

The dataset, sourced from Kaggle, includes ride-hailing information from Uber and Lyft in Boston, MA, along with concurrent weather conditions. Despite numerous NA values, its simplicity makes it ideal for linear regression analysis to examine patterns between variables like time and pricing. Key weather-related attributes include temperature, wind conditions, and sunset times, offering additional layers for predictive modeling.

The dataset contains 693,071 records and 57 variables, capturing various aspects of ride-hailing services. The data includes hour, destination, location coordinates, pricing, distance, and weather conditions among other variables.

## 3.2 Smart Questions

1. Is there any relationship between price and hour?

2. Is there any relationship between price and cabin types?

3. Do the weather factors, like temperature, wind, and sunset affect the final price?

## 3.3 Descriptive Statistics

```{r, results='markup', echo=TRUE}
df <- data.frame(read.csv('rideshare_kaggle.csv'))
head(df)
```

```{r, results = 'markup', echo=TRUE}
summary(df)
```

In the summary graph, it is evident that the surge_multiplier consistently remains at 1. This indicates that the majority of customers either tip only $1 or do not tip the rider at all.

## 3.4 Data Cleaning and Preprocessing

### 3.4.1 Data Cleaning

Before proceeding with further exploratory data analysis (EDA) and modeling, the initial step involves data cleaning. This entails removing all null values from the dataset to obtain a refined version.

```{r, results='markup', echo=TRUE}
# check null values
sum(is.na(df)) 
# Drop NA values
df <- na.omit(df)
```

### 3.4.2 Data Preprocessing

Within our dataset, it is necessary to modify certain column names to facilitate subsequent steps in EDA and modeling.

```{r, results='markup', echo=TRUE}
#alter col names
colnames(df)[colnames(df) == "cab_type"] <- "cab_company"
colnames(df)[colnames(df) == "name"] <- "cab_type"
head(df)
```


For cab_company, we can see there are 2 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_company) #see unique values in company
```

For cab_type, we can see there are 12 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_type) #see unique values in cab_type
```

```{r, results='markup', echo=TRUE}
# Filter the data for each company
df_lyft <- df[df$cab_company == "Lyft",]
df_uber <- df[df$cab_company == "Uber",]
```


## 3.5 Data Visulazition

### 3.5.1 Boxplot for Price and Destination

```{r, results='markup', echo=TRUE}
# Categorical boxplot
ggplot(df, aes(x = destination, y = price, fill = cab_company)) +
  geom_boxplot() +
  theme_minimal(base_size = 18)
```

The boxplot comparison between Lyft and Uber indicates that Lyft's median prices are consistently higher than Uber's for the same destinations. This pattern suggests that Lyft may employ a pricing strategy that places its services at a premium compared to Uber across various routes.

### 3.5.2 Time Series Analysis for Hour and Price

```{r, results='markup', echo=TRUE}

# Extract relevant columns from 'data' into 'cab_data'
cab_data <- df[c("hour", "price", "cab_company")]

# Filter the data for each company
uber_data <- cab_data[cab_data$cab_company == 'Uber',]
lyft_data <- cab_data[cab_data$cab_company == 'Lyft',]

# Plot for Uber
ggplot(data = uber_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "blue") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Uber Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Plot for Lyft
ggplot(data = lyft_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "red") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Lyft Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Combined plot 
ggplot(data = cab_data, aes(x = hour, y = price, color = cab_company, group = cab_company)) + 
  geom_line() + 
  geom_point(aes(shape = cab_company)) +
  labs(title = "Hourly Uber vs Lyft Prices", x = "Hour", y = "Price") +
  scale_color_manual(values = c("blue", "red")) +
  theme_minimal()
```
The first graph illustrates fluctuations in Uber prices throughout the day, with notable peaks occurring during early morning hours, as well as during typical morning and evening rush hours, indicating a correlation between price surges and high-demand times.

The second graphical analysis indicates that Lyft's pricing experiences a notable peak at 1 a.m., possibly reflecting a surge pricing mechanism in response to nightlife transit demand. Contrary to a typical diurnal pattern, Lyft's pricing does not exhibit a clear, consistent trend across the 24-hour cycle, suggesting a more complex interplay of factors influencing fare changes beyond mere temporal demand.

The composite time series graph illustrates a comparative analysis of Uber and Lyft pricing across various hours. The visual data suggests that Lyft's pricing structure exhibits greater variability and higher pricing peaks when compared to Uber. This may be indicative of Lyft's dynamic pricing strategy, which appears to be more sensitive to fluctuations in demand or other operational variables within the same temporal framework.


### 3.5.3 Histogram of Price by cab_company

```{r, results='markup', echo=TRUE}
# Create a figure with two subplots
par(mfrow=c(1, 2), mar=c(5, 4, 4, 2))  # 1 row, 2 columns

# Plot histograms by cab_type for Lyft
hist(df$price[df$cab_company == "Lyft"], col="orange", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Lyft)")

# Plot histograms by cab_type for Uber
hist(df$price[df$cab_company == "Uber"], col="blue", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Uber)")

# Add legend to the figure
legend("topright", legend=c("Uber", "Lyft"), fill=c("blue", "orange"))
```

The orange histogram represents Lyft, showing a peak in the lower price range, indicating a high frequency of rides at lower prices. The blue histogram for Uber also shows a high frequency in the lower price range but with a greater spread in the distribution of prices, suggesting a wider variation in Uber's ride prices compared to Lyft. 

### 3.5.4 Boxplot of Prices by cab_type

```{r, results='markup', echo=TRUE}
df_lyft <- df[df$cab_company == "Lyft",]
df_uber <- df[df$cab_company == "Uber",]

# Combine the data for Lyft and Uber
df_combined <- rbind(df_lyft, df_uber)

# Calculate the median price for each cab type and order them
median_prices <- df_combined %>%
  group_by(cab_type) %>%
  summarize(median_price = median(price)) %>%
  arrange(desc(median_price))

# Reorder the levels of the cab_type factor based on median price
df_combined$cab_type <- factor(df_combined$cab_type, levels = median_prices$cab_type)

# Create a ggplot object for both Lyft and Uber with cab_type reordered
p_combined <- ggplot(df_combined, aes(x = cab_type, y = price, fill = cab_company)) +
  geom_boxplot(width = 0.5, outlier.shape = 1, outlier.size = 2, fatten = 0.5) +  # Adjust outlier size and line thickness
  labs(x = "Cab Type", y = "Price", title = "Boxplot of Prices by Cab Type (Ordered by Median Price)") +
  scale_fill_manual(values = c("Lyft" = "blue", "Uber" = "red")) +  # Set custom colors
  theme_minimal() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5),
    plot.margin = unit(c(1, 2, 1, 1), "cm")
  )

# Print the combined plot with modified aesthetics
p_combined
```

The boxplot presents a comparison of median prices by cab type for Lyft and Uber. Lux Black XL, Black SUV, and Lux Black are the most expensive options with Lyft generally showing higher median prices than Uber. The cheapest options like UberPool and Shared show much lower median prices. This visual suggests a distinct price range based on the luxury level of the cab type selected.

### 3.5.5 Scatter Plot for Distance and Price

```{r, results='markup', echo=TRUE}
# Scatter plot: Examine the relationship between price and distance
ggplot(df, aes(x = distance, y = price)) +
  geom_point(aes(color = price), alpha = 0.5) +    # Use color to represent the value of price and set point transparency to 0.5
  labs(title = "The Plot of Price vs. Distance",    # Chart title
       x = "Distance",                              # x-axis title
       y = "Price",                                 # y-axis title
       color = "Price Value") +                     # Legend title
  theme_minimal()                                   # Use a minimalistic theme
```

The scatter plot indicates a wide range of ride prices across varying distances. The densest cluster of data points suggests that most rides are concentrated within a shorter distance range with prices mainly below $50. There are visible outliers representing longer trips with higher prices, demonstrating that as the distance increases, the potential for higher ride prices also increases.


### 3.5.6 Boxplot for surge_multiplier and price

```{r, results='markup', echo=TRUE}
# Box plot: Examine the distribution of price across different surge multipliers
ggplot(df, aes(x = factor(surge_multiplier), y = price)) +  # Convert surge_multiplier to factor for a clearer plot
  geom_boxplot(aes(fill = factor(surge_multiplier))) +        # Fill boxes with colors based on surge_multiplier
  labs(title = "Boxplot of Price across Different Surge Multipliers",
       x = "Surge Multiplier",
       y = "Price",
       fill = "Surge Multiplier Categories") +
  theme_minimal()
```

The boxplot showcases the distribution of prices across different surge multiplier categories for a ride-hailing service. The median prices tend to increase with higher surge multipliers, indicating a direct relationship between price surges and increased costs. The spread and outliers within each category suggest variability in pricing even within the same surge multiplier level.

### 3.5.7 3D Scatter plot for Hour, Distance, and Price
```{r, results='markup', echo=TRUE}
# Create a 3D scatter plot
plot_ly(data = df, x = ~hour, y = ~distance, z = ~price, type = "scatter3d", mode = "markers", marker = list(size = 1)) %>%
  layout(scene = list(xaxis = list(title = "Hour"), yaxis = list(title = "Distance"), zaxis = list(title = "Price")))

```

The three-dimensional scatter plot offers a comprehensive view of how price correlates with both distance and time. While there is a visible concentration of data suggesting a foundational fare, the dispersion across hours and distances highlights the complexity of pricing dynamics in ride-hailing services.


### 3.5.8 Heatmap for All Variables

```{r, results='markup', echo=TRUE}
# Correlation heatmap
numeric_df <- select_if(df, is.numeric)
corr_all <- cor(numeric_df)
heatmap.2(corr_all, 
          main = "Correlation Heatmap",  # title
          key = TRUE,  # show color
          density.info = "none",  # prevent duplicate color
          trace = "none",  # prevent trace
          cellnote = round(corr_all, 2),  # show cor
          notecol = "black",  # color for cor
          margins = c(3, 3),  # set margins
          col = colorRampPalette(c("blue", "white", "red"))(100)  # set color
)
```

From this correlation heatmap, we are able to filter out some irrelevant variables for price. Surge_multiplier and distance have the highest correlation with price at 0.24 and 0.35. The hour and weekday have a relatively low correlation with price. Other variables such as weather condition like humidity and visibility are having 0 correlation with price.

## 3.6 Test normality

```{r, results='markup', echo=TRUE}
# measure of variance
sd(df$price)
sd(df$distance)
sd(df$surge_multiplier)
```


```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$hour)

# Create a Q-Q plot
qqnorm(df$hour)
qqline(df$hour)

# Create a density plot
plot(density(df$hour))
```

The histogram indicates a roughly uniform distribution with a slight decrease towards the higher end. The Q-Q plot suggests the data deviate from normality, particularly at lower and higher quantiles. Lastly, the density plot shows a multimodal distribution with several peaks, suggesting certain hours have higher frequencies.

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$price)

# Create a Q-Q plot
qqnorm(df$price)
qqline(df$price)
plot(density(df$price))
```

The three graphs collectively suggest that the distribution of prices is not normal; there is a skew towards lower prices with frequent spikes. The histogram shows a right-skewed distribution with most prices clustered at the lower end. The Q-Q plot indicates deviation from normality, especially at the higher quantiles. The density plot reveals multiple peaks, indicating potential groupings or tiers in pricing structure.

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$distance)

# Create a Q-Q plot
qqnorm(df$distance)
qqline(df$distance)
plot(density(df$distance))
```

The histogram of 'df$distance' displays a right-skewed distribution, indicating that shorter trips are more frequent. The Q-Q plot also shows deviation from normality, especially for longer trips, while the density plot reveals multiple peaks, which may represent common travel distances.

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$surge_multiplier)

# Create a Q-Q plot
qqnorm(df$surge_multiplier)
qqline(df$surge_multiplier)
plot(density(df$surge_multiplier))
```

The histogram and density plot for `df$surge_multiplier` show a highly skewed distribution with most values concentrated at 1, indicating that surge pricing is infrequently applied. The Q-Q plot further illustrates that surge multipliers do not follow a normal distribution, with a steep departure from the theoretical line.

## 3.7 Hypothesis Testing

```{r}
# Chi-squared test for cab_company and cab_type
chisq_result <- chisq.test(df$cab_company, df$cab_type)

chisq_result

```

With a Chi-squared value (X-squared) of 600,000 and a degrees of freedom (df) of 11, the test result is highly significant (p-value < 2e-16). This suggests that there is a statistically significant association between the cab company (e.g., Lyft or Uber) and the type of cab service offered (e.g., shared, Lux, Lyft, etc.). In other words, the type of cab service is not independent of the cab company; there's a strong relationship between these two variables in the dataset.

```{r, results='markup',echo=TRUE}
# Perform T-test to compare prices between two cab companies
t_test_result <- t.test(price ~ cab_company, data = df)

# Print the results
print(t_test_result)
```

With a t-value of 66 and degrees of freedom approximately 600,000, the test shows a highly significant p-value (<2e-16), indicating that the average prices of Lyft and Uber are statistically different. The 95% confidence interval for the difference in means ranges from 1.51 to 1.60, suggesting that, on average, Lyft's prices are higher than Uber's by this amount. The mean price for Lyft is 17.4 and for Uber is 15.8, reinforcing this conclusion.

## 3.8 Summary and Answer Smart Questions

### 3.8.1 Summary

The EDA of a dataset comprising ride-hailing data from Uber and Lyft in Boston, MA, along with concurrent weather conditions, yielded insightful findings. After cleaning and preprocessing the data, we delved into data visualization techniques. Boxplots indicated that Lyft consistently had higher median prices than Uber for the same destinations, suggesting a pricing strategy premium. Time series analysis unveiled price surges during high-demand hours for both Uber and Lyft. Histograms and boxplots revealed that Lyft generally had higher median prices than Uber, with distinct price ranges for different cab types. A scatter plot depicted a wide range of prices for varying distances. A boxplot illustrated the direct relationship between surge pricing and increased costs. A 3D scatter plot highlighted the complexity of price correlations with distance and time. The chi-squared test revealed a significant association between cab company and cab type, while a t-test confirmed Lyft's higher average prices.

### 3.8.2 Answer Smart Questions

1. Is there any relationship between price and hour?
Yes, there is a relationship between price and hour. Both Uber and Lyft experience price surges during high-demand hours, such as early morning and rush hours.

2. Is there any relationship between price and cabin types (cab types)?

Yes, there is a relationship between price and cabin types. Lyft generally has higher median prices than Uber, and different cab types have distinct price ranges.

3. Do weather factors, like temperature, wind, and sunset, affect the final price?
No, in the corelation heatmap, variables such as weather condition like humidity and visibility are having 0 correlation with price. Therefore, it means they have lower relationship with price.

# 4. Modeling

## 4.1 Modeling Data Splitting

We have divided the dataset into two subsets: a training dataset comprising 70% of our data and a testing dataset comprising the remaining 30%.

```{r, results='markup', echo=TRUE}
# Convert timestamp to datetime and extract the weekday
df$timestamp <- as.POSIXct(df$timestamp, format="%Y-%m-%d %H:%M:%S", tz="UTC")
df$weekday <- weekdays(df$timestamp)

# Select the columns you need
X <- df %>% select(weekday, hour, cab_type, cab_company, distance, surge_multiplier, icon, long_summary, short_summary, destination)
y <- df$price

# Split the data into training and testing sets
set.seed(42)  # For reproducibility
split <- sample.split(y, SplitRatio = 0.7)
X_train <- subset(X, split == TRUE)
X_test <- subset(X, split == FALSE)
y_train <- subset(y, split == TRUE)
y_test <- subset(y, split == FALSE)

```

```{r, results='markup', echo=TRUE}
# Convert text feature to Corpus
corpus_train <- Corpus(VectorSource(X_train$long_summary))
corpus_test <- Corpus(VectorSource(X_test$long_summary))

# Create a document-term matrix for TF-IDF
dtm_train <- DocumentTermMatrix(corpus_train)
dtm_test <- DocumentTermMatrix(corpus_test, control = list(dictionary = Terms(dtm_train)))

# Apply TF-IDF weighting
tfidf_train <- weightTfIdf(dtm_train)
tfidf_test <- weightTfIdf(dtm_test)

# Convert to matrix
mat_train <- as.matrix(tfidf_train)
mat_test <- as.matrix(tfidf_test)

# Apply Truncated SVD
svd_train <- irlba(mat_train, nv = 10)
svd_test <- irlba(mat_test, nv = 10)

# Create data frames from SVD output
text_train <- as.data.frame(svd_train$u)
names(text_train) <- paste("text", seq(1, ncol(text_train)), sep = "")

text_test <- as.data.frame(svd_test$u)
names(text_test) <- paste("text", seq(1, ncol(text_test)), sep = "")

# Reset index before merging - in R, we can directly merge
X_train <- cbind(X_train, text_train)
X_test <- cbind(X_test, text_test)

# Drop the original 'long_summary' column
X_train$long_summary <- NULL
X_test$long_summary <- NULL

```

```{r, results='markup', echo=TRUE}

# Define the mapping as a named vector in R
ordinal_enc <- c('Shared' = 1, 'UberPool' = 1, 'Lyft' = 2, 'UberX' = 3, 'WAV' = 3,
                 'UberXL' = 4, 'Lyft XL' = 4, 'Lux' = 5, 'Lux Black' = 6, 'Black' = 6,
                 'Lux Black XL' = 7, 'Black SUV' = 7)

# Replace the 'name' column in X_train and X_test with the mapped values
X_train <- X_train %>% 
  mutate(cab_type = recode(cab_type, !!!ordinal_enc))

X_test <- X_test %>% 
  mutate(cab_type = recode(cab_type, !!!ordinal_enc))

```

```{r, results='markup', echo=TRUE}
# Preprocessing for categorical variables
rec <- recipe(~ ., data = X_train) %>%
      step_dummy(all_nominal(), -all_outcomes())

# Prepare and bake the recipe
prep_rec <- prep(rec, training = X_train)
X_train_processed <- bake(prep_rec, X_train)
X_test_processed <- bake(prep_rec, X_test)
```

## 4.2 Linear Model


```{r, results='markup', echo=TRUE}
# Linear Regression
linear_model <- lm(y_train ~ ., data = X_train_processed)
summary(linear_model)

```

Our comprehensive analysis delved into the determinants of pricing for ride-hailing services, focusing on the significance of travel distance, time-based pricing multipliers, and temporal factors. We employed an extensive dataset, selecting price as our dependent variable, influenced by a suite of predictors: weekday, hour, cab type and company, distance, and various weather-related descriptors. The refined linear regression model demonstrated a notable predictive strength, elucidating 85.3% of the variance in prices. The surge multiplier emerged as a particularly strong predictor, underscoring its weighty impact on fare costs. Overall, the model's robust statistical indicators, including a residual standard error of 3.58 and a substantial F-statistic, confirm the reliability and explanatory power of our analytical approach in capturing the complexities of ride-hailing pricing dynamics.

## 4.3 PCR Model

```{r, results='markup', echo=TRUE}
pcr_model <- pcr(y_train ~ ., data = X_train_processed, scale = TRUE, validation = "CV")
summary(pcr_model)
```

Subsequent to our initial linear regression analysis, we incorporated Principal Component Regression (PCR) to address multicollinearity and enhance model precision. We deployed a linear regression model with x_train_processed data to predict y_train (price), rigorously evaluating residuals, coefficients, and fit indices to validate the model. PCR application resolved issues of high dimensionality and multicollinearity, with the reduction in RMSEP values and increased components suggesting predictive accuracy enhancements. The model's high R-squared value signifies its capability to capture pricing dynamics effectively, with PCR offering further refinement by adeptly managing data complexity and reaffirming the stability of our predictive constructs.


## 4.4 Tree Model

```{r, results='markup', echo=TRUE}
# Tree Analysis
tree_model <- tree(y_train ~ ., data = X_train_processed)

# Summary of the tree model
summary(tree_model)

# Plot the tree
plot(tree_model)
text(tree_model, pretty = 0)
```

Our study delved into the complexities of pricing within ride-hailing service data through decision tree analysis, a robust method for capturing non-linear relationships. We concentrated on the influence of "cab_type" and "distance" on the "y_train" price variable, utilizing a regression tree to uncover intricate pricing strategies. The resulting tree, which posited "cab_type" as the root node and "distance" as a critical branch modifier, consisted of seven terminal nodes, underscoring the primary importance of these variables in pricing decisions.

The model exhibited a mean residual deviation of 13.4, indicative of the variability in price predictions, with residuals ranging notably from -9.3 to 59.7. Despite this spread, the proximity of the median residual to -0.3 suggests a commendable model fit. The decision rules derived from the tree confirm "cab_type" as a pivotal predictor, with "distance" providing nuanced delineation of price increments related to longer journeys. The broad range of residuals, while highlighting predictive variability, does not detract from the model’s overall fitting accuracy.

# 5 Conclusion

Our comprehensive statistical analysis has elucidated several influential factors on ride-hailing prices. The type of cab (`cab_type`) emerges as a highly significant predictor, indicating that different service levels or cab models may attract different pricing. Distance traveled has also been confirmed to play a crucial role, with a clear positive correlation with price. Furthermore, the `surge_multiplier`, reflective of demand-driven pricing adjustments, significantly influences ride costs.

Interestingly, the analysis reveals that rides associated with Uber, as differentiated by the `cab_company_Uber` variable, may be priced distinctively compared to those from Lyft, suggesting competitive pricing strategies or different service offerings between the two companies.

While weather and time-related factors, including `icon` variables and `hour` or `weekday`, were considered in the model, they do not appear to substantially impact pricing, as indicated by their less significant p-values. This could point to the robustness of ride-hailing services in maintaining consistent pricing irrespective of these variables, or it might suggest that the effects of weather and time are subsumed by other more dominant factors.

The influence of destination on pricing also cannot be ignored. Specific locations are associated with significant pricing differences, which could be attributed to factors like average trip lengths, typical traffic conditions, or the popularity of the destination.

The performance of the linear regression model, evidenced by a high multiple R-squared value of 0.853, indicates that a significant portion of the variance in ride prices is well explained by the variables included in the model. However, the range of residuals points to the existence of outliers or exceptional pricing scenarios that the model does not fully capture, signaling an area for further research.

Principal Component Regression (PCR) analysis further refines our understanding by demonstrating that incorporate a greater number of components significantly improves the model's prediction accuracy, especially beyond the inclusion of 27 components.
The regression tree analysis corroborates the findings from the linear model, highlighting cab_type and distance as primary variables. The tree's structure provides a clear and actionable decision-making framework for predicting prices based on these variables.

Overall, this study provides a robust framework for understanding the determinants of ride-hailing prices, offering valuable insights for service providers to optimize their pricing strategies and for consumers to make informed decisions. While the models presented are insightful, the complexity of ride-hailing pricing dynamics warrants further investigation into additional variables and possibly more sophisticated modeling approaches to capture the full spectrum of influences on ride prices.

# Reference

1.Brllrb. (2019). Uber and Lyft Dataset: Boston, MA. Kaggle. https://www.kaggle.com/datasets/brllrb/uber-and-lyft-dataset-boston-ma/data.

2.NYC Data Science Academy. (n.d.). Uber vs. Lyft: A Data Analysis of the Rideshare Market in Boston. Retrieved from https://nycdatascience.com/blog/student-works/uber-vs-lyft-a-data-analysis-of-the-rideshare-market-in-boston/.
