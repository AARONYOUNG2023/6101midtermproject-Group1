---
title: "Factors Influencing Ride-Sharing Pricing in Boston: A Study on Lyft and Uber"
subtitle: "DATS_6101_Midterm_Project_Summary_Paper"
author: "Jianjun Gao, Aaron Yang, Luhuan Wang"
advisor: "Dr. Mohamed Shabani Kariburyo"
# date: "10/31/2023"
date: "`r Sys.Date()`" 
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float: yes
    number_sections: false
    fig_caption: true
    df_print: paged

---
# Introduction

With the development of science and technology in modern society, in today's digital and information society, the sharing economy has become a part of the business world. The fast-paced life has also brought more and more consumers to many shared transportation services. To meet consumer demand, companies such as Uber and Lyft have become ubiquitous. These companies have made a profound impact on urban mobility by providing fast and convenient personal transportation services. And the price of these convenient travel services is a key decision-making factor.
The price dynamics of Uber and Lyft are affected not only by market forces and the competitive environment, but also by various internal and external factors. Therefore, understanding the various factors that influence Uber and Lyft prices has become an important area of research in business and academia. This issue is not only critical to the company's success, but also has broad implications for consumers, governments, and city planners.

Why study the factors that affect Uber and Lyft prices? First, research on this issue helps consumers better understand the reasons for price changes. This can help them make smarter travel decisions and save money. Second, for governments and urban planners, understanding the impact of price factors can help better plan urban transportation, reduce traffic congestion, and improve environmental sustainability. Most importantly, in-depth research on Uber and Lyft prices helps these companies better understand market demand, optimize their pricing strategies, and provide better services.
The goal of this paper is to explore the factors that affect Uber and Lyft prices, including time period, tip level, trip length, and special events. We will focus on the city of Boston in the United States as a research object to explore the impact of the city’s unique factors on Uber and Lyft prices. We'll take a closer look at how these factors affect prices by analyzing relevant data and models. Through this study, we hope to provide additional insights into understanding the complexity of pricing decisions in the sharing economy.

Next, we use R to study in detail the various factors that affect Uber and Lyft prices, analyze their mechanisms of action, and discuss their practical impact. This will help form a more comprehensive understanding and provide more insights and references for pricing decisions in ride-sharing software.




# Factors Influencing Ride-Sharing Pricing in Boston: A Study on Lyft and Uber

## Select Data
First, we tried to find data about Uber and Lyft in Boston, and used Python to cut the data to facilitate our analysis. These big data sets are often extremely large and therefore require effective data processing techniques to divide the big data sets into smaller, more manageable parts for deeper analysis and exploration.
After cutting out the appropriate data, we can start making EDA.

## 
```{r init, include=F,error=TRUE}
# Loading the libraries.
library(ggplot2)
library(ezids)
library(gplots)
library(dplyr)
library(plotly)
```

```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```
## Loading the Data from Csv File
**Look at first 6 rows of the data.**
```{r, results='markup', echo=TRUE}
df <- data.frame(read.csv('final_dataset.csv'))
head(df)
```
## Data EDA
**Get summary from the data**

We want to have an initial look at the descriptive stats of the dataset. In the same time, check for the null values of the data.
```{r, results='markup', echo=TRUE}
summary(df) # descriptive stats
sum(is.na(df)) # check null values
```
**Alter column names**

We found that some of the cols are named incorrectlly, we need to alter them.
```{r, results='markup', echo=TRUE}
#alter col names
colnames(df)[colnames(df) == "cab_type"] <- "cab_company"
colnames(df)[colnames(df) == "name"] <- "cab_type"
head(df)
```

**Check for unique values in catgorial columns**

For cab_company, we can see there are 2 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_company) #see unique values in company
```

For cab_type, we can see there are 12 unique values.
```{r, results='markup', echo=TRUE}
unique(df$cab_type) #see unique values in cab_type
```

## Data Visualization
**Hour vs Mean_Price**

Firstly, we want to see the relationship of hours contributed to mean_price. The time factor behind analyzing and understanding price movements has always been a matter of great concern. Especially in the world of taxi services, the impact of time on price can be critical.
Online car hailing services often experience price fluctuations during different times of the day. These fluctuations can be affected by a variety of factors. Therefore, we have reason to believe that different time periods may have a significant impact on the price of online car hailing services.



```{r, results='markup', echo=TRUE}

# Extract relevant columns from 'data' into 'cab_data'
cab_data <- df[c("hour", "price", "cab_company")]

# Filter the data for each company
uber_data <- cab_data[cab_data$cab_company == 'Uber',]
lyft_data <- cab_data[cab_data$cab_company == 'Lyft',]

# Plot for Uber
ggplot(data = uber_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "blue") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Uber Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Plot for Lyft
ggplot(data = lyft_data, aes(x = hour, y = price)) + 
  geom_line(aes(group = 1), colour = "red") + 
  geom_point(aes(color = hour)) +
  labs(title = "Hourly Lyft Prices", x = "Hour", y = "Price") +
  theme_minimal()

# Combined plot 
ggplot(data = cab_data, aes(x = hour, y = price, color = cab_company, group = cab_company)) + 
  geom_line() + 
  geom_point(aes(shape = cab_company)) +
  labs(title = "Hourly Uber vs Lyft Prices", x = "Hour", y = "Price") +
  scale_color_manual(values = c("blue", "red")) +
  theme_minimal()
```


Each black dot on the chart represents the price at a specific time. There are multiple points per hour, indicating that the chart shows the price of multiple rides over time. Prices seem to be lowest in the early morning hours (1:00 am), prices rise significantly around 5:00 am, and then gradually decrease until around 8:00 am. From 8:00 am to approximately 16:00 (4:00 pm), prices Remaining relatively stable with slight fluctuations. Starting at 16:00 (4:00 pm), prices seem to rise again and peak around 18:00 (6:00 pm). This may be due to evening rush hour rides Demand is usually higher. After this peak, as the night falls, prices start to fall again.
From this data, one can infer that rides are more expensive during certain times of the day, possibly due to increased demand.




**Company vs price**

We want to see if there is a difference in price in case of uber and lyft.
In the field of shared travel services, Uber and Lyft have always attracted much attention. Whether there are differences in pricing strategies between the two service providers and whether there is a significant price difference has always been a compelling question.
Uber and Lyft may adopt different pricing strategies, including basic prices, per-kilometer charges, and price increases during peak hours. The difference in prices between Uber and Lyft under different conditions can be used as an observation point
Using data visualization and statistical methods, we will compare Uber and Lyft price data.

```{r, results='markup', echo=TRUE}
# Create a figure with two subplots
par(mfrow=c(1, 2), mar=c(5, 4, 4, 2))  # 1 row, 2 columns

# Plot histograms by cab_type for Lyft
hist(df$price[df$cab_company == "Lyft"], col="orange", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Lyft)")

# Plot histograms by cab_type for Uber
hist(df$price[df$cab_company == "Uber"], col="blue", xlab="Price", ylab="Frequency", main="Histogram of Prices by Cab Company (Uber)")

# Add legend to the figure
legend("topright", legend=c("Uber", "Lyft"), fill=c("blue", "orange"))
```

**Cab types vs Price**

Then,we want to see if cab types affect prices, we will then explore the impact of Cab_Type on price, exploring the role of different online car hailing types in pricing strategy and market demand. Different categories of Cab_Type and their possible influencing factors.
```{r, results='markup', echo=TRUE}
df_lyft <- df[df$cab_company == "Lyft",]
df_uber <- df[df$cab_company == "Uber",]

# Combine the data for Lyft and Uber
df_combined <- rbind(df_lyft, df_uber)

# Calculate the median price for each cab type and order them
median_prices <- df_combined %>%
  group_by(cab_type) %>%
  summarize(median_price = median(price)) %>%
  arrange(desc(median_price))

# Reorder the levels of the cab_type factor based on median price
df_combined$cab_type <- factor(df_combined$cab_type, levels = median_prices$cab_type)

# Create a ggplot object for both Lyft and Uber with cab_type reordered
p_combined <- ggplot(df_combined, aes(x = cab_type, y = price, fill = cab_company)) +
  geom_boxplot(width = 0.5, outlier.shape = 1, outlier.size = 2, fatten = 0.5) +  # Adjust outlier size and line thickness
  labs(x = "Cab Type", y = "Price", title = "Boxplot of Prices by Cab Type (Ordered by Median Price)") +
  scale_fill_manual(values = c("Lyft" = "blue", "Uber" = "red")) +  # Set custom colors
  theme_minimal() +
  theme(
    legend.position = "top",
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.text = element_text(size = 12),
    axis.title = element_text(size = 14),
    axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5),
    plot.margin = unit(c(1, 2, 1, 1), "cm")
  )

# Print the combined plot with modified aesthetics
p_combined


```

From the chart, we tried to analyze cab_type and price in Lyft:
Lux has the lowest median price in the luxury category, with some outliers at the high end.
Lux Black and Lux Black XL have higher median prices, suggesting they offer better service. Lyft and Lyft XL have lower median prices than luxury cars, making them more affordable for average users. Lyft XL's price range is slightly higher than standard Lyft, likely due to its larger vehicle capacity. As expected, shared rides have the lowest median prices because riders share the cost with others.

And taxi types and prices in Uber:
Black and black SUVs have higher median prices, reflecting their premium nature.
UberPool has a tight price distribution, with the lowest median price, which is expected since it is a shared service. UberX has a slightly higher median price than UberPool, but is more affordable than luxury cars. UberXL has a higher median price than UberX due to its larger vehicle capacity. WAV has a narrow price distribution, but its median price is relatively high.


**Distance vs Price**

Next, we use scatter plot to see the relationship between the distance and price. 
In data analysis and visualization, scatter plots have always been an important tool for exploring the relationship between two variables.
Ride distance and price are two key factors in shared mobility services. Passengers often want to understand the relationship between the two to better estimate the cost of a trip, while online car hailing service providers need to understand how to price trips of different distances. Therefore, by using a scatter plot, we can present the data points of these two variables in a visual way to reveal the relationship between them.
Next, we will create a scatter plot, through this visualization we will be able to see trends and patterns between distance and price. We will better understand the relationship between ride distance and price.

```{r, results='markup', echo=TRUE}
# Scatter plot: Examine the relationship between price and distance
ggplot(df, aes(x = distance, y = price)) +
  geom_point(aes(color = price), alpha = 0.5) +    # Use color to represent the value of price and set point transparency to 0.5
  labs(title = "The Plot of Price vs. Distance",    # Chart title
       x = "Distance",                              # x-axis title
       y = "Price",                                 # y-axis title
       color = "Price Value") +                     # Legend title
  theme_minimal()                                   # Use a minimalistic theme
```

Based on observing this picture, we find that:
The density of data points between 0 and 4 distance units is high, especially in the 0-20 price range. This suggests that most are relatively cheap short trips.
Distance trend: Prices generally seem to increase as we move from left to right on the distance axis, which is an expected trend since longer trips should cost more. However, there are significant differences in prices for similar distances, suggesting that factors other than distance influence prices.
Outliers: Some trips are relatively short but expensive. This could be due to price increases during peak times, luxury ride options or other premium services.
Beyond a distance of 4 units, the data points are more spread out. The longer rides have fewer rides and a greater price difference. It's also worth noting that the density of data points in the higher price ranges is sparse, suggesting that high-priced rides over long distances are less common.
Overall, this graph can be seen as to how distance affects the price of a Lyft and Uber ride. While distance is an important factor, the price differences for similar distances suggest that other factors play a role in determining the final price of a ride.

**Surge_multiplier vs Price**

We will use a boxplot to explore the relationship between "surge_multiplier" and price.
In the field of shared travel services, "surge_multiplier" is an important pricing factor, which may affect passengers' decisions to choose shared travel services during peak hours. By using boxplots, we will visually show the impact of different "surge_multiplier" values on the price. Boxplots will help us understand the following questions: How is the distribution of prices at different multiplication factors? Are there price anomalies or trends related to the multiplication factor?

```{r, results='markup', echo=TRUE}
# Box plot: Examine the distribution of price across different surge multipliers
ggplot(df, aes(x = factor(surge_multiplier), y = price)) +  # Convert surge_multiplier to factor for a clearer plot
  geom_boxplot(aes(fill = factor(surge_multiplier))) +        # Fill boxes with colors based on surge_multiplier
  labs(title = "Boxplot of Price across Different Surge Multipliers",
       x = "Surge Multiplier",
       y = "Price",
       fill = "Surge Multiplier Categories") +
  theme_minimal()
```
After observing the visualized data, we conclude：
As the surge multiplier increases, there's a general trend of increasing median price. This is expected since a higher surge multiplier means higher fare.
There are outliers in the 1x multiplier category, indicating that even without surge pricing, there are instances where rides can be quite expensive. This could be due to other factors like distance, duration, or additional fees.
The range of prices (difference between the first and third quartile) seems to be more variable for higher surge multipliers, particularly 1.75x and 2.5x. This suggests that there's a wider variation in ride costs when surge pricing is at its highest.


**Plot a 3D scatter plot with arguements hour, distance, price**

In data visualization, 3D scatter plot is a powerful tool for showing the relationship between three variables at the same time. For better observation and confirmation, we will create a 3D scatter plot to study the relationship between the three variables "hour" , "distance"  and "price".
Time, distance and price are key factors in shared mobility services, and they are intertwined to affect the ride experience and cost. With a 3D scatter plot, we will be able to show the relationship between these variables in a three-dimensional way.
``````{r, results='markup', echo=TRUE}
# Create a 3D scatter plot
plot_ly(data = df, x = ~hour, y = ~distance, z = ~price, type = "scatter3d", mode = "markers", marker = list(size = 1)) %>%
  layout(scene = list(xaxis = list(title = "Hour"), yaxis = list(title = "Distance"), zaxis = list(title = "Price")))

```

By observing the 3D diagram, we found:
There is a clear trend between price and distance, with prices increasing as distance increases, indicating a positive relationship between the two. This is consistent with the typical pricing model for ride-sharing services, where longer rides generally cost more.
There seems to be no clear relationship between price and time. The data points are somewhat evenly distributed across time periods, suggesting that time may not be an important factor in determining price. There's also no obvious pattern linking specific times of day to longer or shorter rides.
Density: The concentration of data points in the middle area indicates that most trips are in the mid-price range and cover average distances. Very short or very long rides are less common.


## Description Statistics

**Show standard deviations**

```{r, results='markup', echo=TRUE}
# measure of variance
sd(df$price)
sd(df$distance)
sd(df$surge_multiplier)
```

**Test normality**

For hour
```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$hour)

# Create a Q-Q plot
qqnorm(df$hour)
qqline(df$hour)

# Create a density plot
plot(density(df$hour))
```

For price

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$price)

# Create a Q-Q plot
qqnorm(df$price)
qqline(df$price)
plot(density(df$price))
```

For distance

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$distance)

# Create a Q-Q plot
qqnorm(df$distance)
qqline(df$distance)
plot(density(df$distance))
```

For surge_multiplier

```{r, results='markup', echo=TRUE}
# Create a histogram
hist(df$surge_multiplier)

# Create a Q-Q plot
qqnorm(df$surge_multiplier)
qqline(df$surge_multiplier)
plot(density(df$surge_multiplier))
```

## Correlation Heatmap for Numeric Colmns

```{r, results='markup', echo=TRUE}
#plot a correlation heat map
df_numeric <- df[,1:4] #only numeric cols
cor_matrix <- cor(df_numeric) #cor matrix

heatmap.2(cor_matrix, 
          main = "Correlation Heatmap",  # title
          key = TRUE,  # show color
          density.info = "none",  # prevent duplicate color
          trace = "none",  # prevent trace
          cellnote = round(cor_matrix, 2),  # show cor
          notecol = "black",  # color for cor
          margins = c(5, 5),  # set margins
          col = colorRampPalette(c("blue", "white", "red"))(100)  # set color
)
```

## Chi-Squared Test for Cab_company & Cab_type

```{r, results='markup', echo=TRUE}
# Chi-squared test
chisq_result <- chisq.test(df$cab_company, df$cab_type)

chisq_result
```

## Linear Regression Analysis for distance & surge_multiplier & hour

```{r, results='markup', echo=TRUE}
#linear regression analysis
linear_model <- lm(price~distance + surge_multiplier,data = df)
summary(linear_model)
```




# Summary
In our data analysis, we looked at the relationship between Uber and Lyft prices and different factors. Our results show that there is a strong correlation between distance and the surge_multiplier in the number of passengers during peak hours and price. In particular, distance and the doubling of passenger numbers during peak hours can largely explain changes in prices. This means that longer distances and doubling the number of passengers during peak times tend to lead to higher prices, which are key factors for both passengers and drivers.
In contrast, the time factor (hours) does not have a strong explanatory power on prices. Our analysis found that the correlation between time and price is relatively weak, and even if we try to exclude the impact of time factors on price, there is no significant change. This may indicate that time is not the main factor in determining price.
Furthermore, we observe a linear relationship between distance, doubling of peak-hour passenger numbers, and price, meaning that changes in price can be explained by a linear combination of these factors.
In our research, we also found a strong correlation between "cab_company" and "cab_type". This may be because Uber and Lyft's pricing strategies relate to different taxi companies and car models. Especially "cab_type" as a string type variable, we did not study it in depth, but we think that in future research, it may become an important factor, because different types of cars may have a significant impact on the price.
Overall, our study provides useful insights into the factors that drive Uber and Lyft prices, highlights the importance of distance and peak-hour ridership doubling, and points to some potential research directions such as different taxis The impact of company and model on price. These results contribute to a better understanding of price-setting strategies for shared mobility services, providing more information and insights to passengers and drivers.


# Reference Page

1.Brllrb. (2019). Uber and Lyft Dataset: Boston, MA. Kaggle. https://www.kaggle.com/datasets/brllrb/uber-and-lyft-dataset-boston-ma/data

2.Peng, R. D., & Matsui, E. (2016). Art of Data Science.
